# Bot_dasha

## Дедлайны

1. Главный дедлайн: **20.12.2025**.  
2. TL команды собирает достижения всех участников и свои, описывает их в документе в папке `final_project`.  
3. Промежуточный дедлайн: **30.11.2025** – созвон, сверка прогресса, обсуждение, что ещё нужно доделать.

---

## Описание бота

Бот-модератор для Telegram-чатов.

Функции:

- хранит **чёрный список** пользователей, которым нельзя находиться в чатах;
- даёт админам команды для управления этим списком;
- умеет **проверять чат по чёрному списку** и пытаться банить найденных пользователей;
- может по расписанию чистить выбранные чаты в фоне.

Данные хранятся в БД:

- локально по умолчанию используется SQLite (`bot_data.db`);
- в Docker используется Postgres (подключение через `DATABASE_URL`).

---

## Переменные окружения

Задаются в `.env` (реальный `.env` в репозиторий не коммитится):

- `BOT_TOKEN` – токен бота от BotFather;  
- `ADMIN_IDS` – список Telegram-ID админов через запятую  
  (например, `12345,67890`);  
- `DATABASE_URL` – строка подключения к БД, например:
  - локально: `sqlite+aiosqlite:///./bot_data.db`
  - в Docker/Postgres: `postgresql+asyncpg://dashabot:dashabot@db:5432/dashabot`
- `MODERATED_CHAT_IDS` (опционально) – список ID чатов, которые чистить по расписанию.  
  Можно не задавать и добавлять чаты через команду `/addchat`.

---

## Локальный запуск (без Docker)

```bash
git clone https://github.com/Bobrik08/Bot_dasha.git
cd Bot_dasha

python3 -m venv .venv
source .venv/bin/activate        # Windows: .venv\Scripts\activate

pip install -r requirements.txt

# создаём .env и заполняем переменные окружения
cp .env.example .env  # если есть пример, либо создать файл руками

python main.py
```

## запуск через Docker

```bash
docker compose up --build

#запуск на фоне
docker compose up --build -d

#остановка
docker compose down
```

## Команды бота

Все команды реализованы через aiogram-хендлеры и зарегистрированы через set_my_commands,
поэтому отображаются в меню бота.

Доступна всем:
	•	/start – приветствие, кратко объясняет, что делает бот, показывает список основных команд.

Только для админов (ADMIN_IDS):
	•	/adduser ID – добавить пользователя в чёрный список.
Можно указать ID аргументом (/adduser 123456789)
или ответить командой на сообщение нужного пользователя.
	•	/deluser ID – удалить пользователя из чёрного списка.
	•	/stats – статистика модерации:
	•	сколько людей в чёрном списке;
	•	сколько всего действий;
	•	какая была последняя операция.
	•	/force_check – принудительно проверить текущий чат по чёрному списку
и попытаться забанить всех найденных.
	•	/addchat – добавить текущий чат в список чатов, которые бот будет чистить по расписанию.
	•	/delchat – убрать текущий чат из списка чатов под модерацией.

